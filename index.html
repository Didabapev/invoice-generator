<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice Generator</title>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f7fb;
      margin: 0;
      padding: 40px;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
    }

    h1 {
      margin-top: 0;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      padding: 10px 18px;
      border: none;
      border-radius: 10px;
      background: #5b5cff;
      color: #fff;
      cursor: pointer;
      margin-top: 10px;
    }

    button.secondary {
      background: #888;
    }

    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #eee;
    }

    .total {
      text-align: right;
      font-size: 20px;
      margin-top: 20px;
    }

    .actions {
      margin-top: 30px;
      display: flex;
      gap: 10px;
    }
  </style>
</head>

<body>
<div class="container">
  <h1>Invoice Generator</h1>

  <label>Client</label>
  <input id="client" placeholder="Client name">

  <label>Description</label>
  <textarea id="description" placeholder="Invoice description"></textarea>

  <h2>Add Item</h2>
  <input id="itemName" placeholder="Item name">
  <input id="itemQty" type="number" placeholder="Quantity">
  <input id="itemPrice" type="number" placeholder="Price">

  <button id="addItemBtn">Add item</button>

  <table>
    <thead>
      <tr>
        <th>Item</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody id="itemsTable"></tbody>
  </table>

  <div class="total">
    Total: $<span id="total">0</span>
  </div>

  <div class="actions">
    <button id="generateBtn">Generate Invoice (PDF)</button>
    <button class="secondary" id="proBtn">Upgrade to Pro</button>
  </div>
</div>

<script>
let items = [];
let isPro = localStorage.getItem('pro') === 'true';

function saveState() {
  localStorage.setItem('items', JSON.stringify(items));
  localStorage.setItem('client', client.value);
  localStorage.setItem('description', description.value);
}

function loadState() {
  const saved = localStorage.getItem('items');
  if (saved) items = JSON.parse(saved);

  client.value = localStorage.getItem('client') || '';
  description.value = localStorage.getItem('description') || '';

  renderItems();
}

function renderItems() {
  const tbody = document.getElementById('itemsTable');
  tbody.innerHTML = '';

  let total = 0;

  items.forEach(item => {
    const row = document.createElement('tr');
    const rowTotal = item.qty * item.price;
    total += rowTotal;

    row.innerHTML = `
      <td>${item.name}</td>
      <td>${item.qty}</td>
      <td>$${item.price}</td>
      <td>$${rowTotal}</td>
    `;

    tbody.appendChild(row);
  });

  document.getElementById('total').textContent = total;
}

function addItem() {
  const name = itemName.value;
  const qty = Number(itemQty.value);
  const price = Number(itemPrice.value);

  if (!name || !qty || !price) {
    alert('Fill all item fields');
    return;
  }

  items.push({ name, qty, price });
  itemName.value = '';
  itemQty.value = '';
  itemPrice.value = '';

  saveState();
  renderItems();
}

function generateInvoice() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(18);
  doc.text('INVOICE', 20, 20);

  doc.setFontSize(12);
  doc.text(`Client: ${client.value}`, 20, 35);
  doc.text(`Description: ${description.value}`, 20, 45);

  let y = 60;
  let total = 0;

  items.forEach(item => {
    const line = `${item.name} â€” ${item.qty} x $${item.price}`;
    doc.text(line, 20, y);
    total += item.qty * item.price;
    y += 10;
  });

  doc.text(`Total: $${total}`, 20, y + 10);

  if (!isPro) {
    doc.setTextColor(200);
    doc.setFontSize(40);
    doc.text('FREE VERSION', 30, 200, { angle: 45 });
    doc.setTextColor(0);
  }

  doc.save('invoice.pdf');
}

function activatePro() {
  isPro = true;
  localStorage.setItem('pro', 'true');
  alert('Pro activated');
}

document.getElementById('addItemBtn').addEventListener('click', addItem);
document.getElementById('generateBtn').addEventListener('click', generateInvoice);
document.getElementById('proBtn').addEventListener('click', activatePro);

window.onload = loadState;
</script>

</body>
</html>
